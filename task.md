# 页面分类系统改进 - 执行计划

## 📋 需求概述
实现二级分类系统，支持校区和通用篇章在同一层级，校区下包含子篇章。

## ✅ 执行任务清单

### 1. 数据库结构调整
- [ ] 备份现有数据库
- [ ] 修改 `categories` 表结构
  - [ ] 添加 `type` 字段 (campus/section/general)
  - [ ] 添加 `parent_id` 字段（自引用外键）
  - [ ] 添加 `parent_id` 索引
  - [ ] 更新现有数据的 `type` 字段默认值
- [ ] 更新 `categories_with_services` 视图
  - [ ] 支持树形结构查询
  - [ ] 包含子分类信息
- [ ] 创建数据迁移脚本
  - [ ] 将现有分类标记为 'general' 类型
  - [ ] 设置所有现有分类的 `parent_id` 为 NULL

### 2. 后端 API 开发
- [ ] 更新类型定义 (`/types/services.ts`)
  - [ ] 添加 `type` 字段到 `DatabaseCategory`
  - [ ] 添加 `parent_id` 字段
  - [ ] 添加 `children` 可选字段
  - [ ] 更新相关请求/响应类型
- [ ] 修改分类 API (`/app/api/categories/route.ts`)
  - [ ] GET: 支持树形结构返回
  - [ ] GET: 添加 `type` 参数筛选
  - [ ] GET: 添加 `parent_id` 参数筛选
  - [ ] POST: 支持创建不同类型的分类
  - [ ] PUT: 支持更新父子关系
  - [ ] DELETE: 处理级联删除逻辑
- [ ] 修改服务 API (`/app/api/services/route.ts`)
  - [ ] 支持按分类类型筛选
  - [ ] 优化查询性能
- [ ] 添加数据验证
  - [ ] 校区类型不能有 parent_id
  - [ ] section 类型必须有 parent_id
  - [ ] general 类型不能有 parent_id

### 3. 前端组件开发
- [ ] 创建新组件
  - [ ] `CampusSelector.tsx` - 校区选择器组件
  - [ ] `SectionGrid.tsx` - 篇章网格展示组件
  - [ ] `BreadcrumbNav.tsx` - 面包屑导航组件
- [ ] 修改现有组件
  - [ ] `ServicesGrid.tsx`
    - [ ] 支持显示一级分类（校区+通用）
    - [ ] 支持显示二级分类（校区子篇章）
    - [ ] 添加导航层级逻辑
  - [ ] `CategoryCard.tsx`
    - [ ] 根据类型显示不同样式
    - [ ] 添加子分类数量显示
  - [ ] `ServiceCard.tsx`
    - [ ] 显示所属分类路径
- [ ] 更新页面
  - [ ] 主页：显示所有一级分类
  - [ ] 添加路由支持 `/campus/[id]` 和 `/section/[id]`

### 4. 管理后台功能
- [ ] 分类管理页面 (`/app/admin/categories/page.tsx`)
  - [ ] 添加分类类型选择器
  - [ ] 添加父分类选择器
  - [ ] 树形展示分类结构
  - [ ] 支持拖拽排序
  - [ ] 批量操作功能
- [ ] 服务管理页面 (`/app/admin/services/page.tsx`)
  - [ ] 更新分类选择逻辑
  - [ ] 显示完整分类路径
- [ ] 添加数据统计
  - [ ] 各校区服务数量
  - [ ] 通用篇章服务数量

### 5. 数据迁移和初始化
- [ ] 创建示例数据脚本
  - [ ] 添加校区数据（沙河校区、学院路校区）
  - [ ] 添加校区子篇章（美食篇、娱乐篇、运动篇）
  - [ ] 添加通用篇章（学习篇、生活服务）
  - [ ] 迁移现有服务到合适分类
- [ ] 创建数据导入/导出功能
  - [ ] JSON 格式导出
  - [ ] 批量导入接口

### 6. UI/UX 优化
- [ ] 设计视觉层级
  - [ ] 校区卡片样式（带校区图标）
  - [ ] 通用篇章卡片样式（带通用图标）
  - [ ] 子篇章列表样式
- [ ] 添加动画效果
  - [ ] 页面切换动画
  - [ ] 卡片悬停效果
- [ ] 响应式设计
  - [ ] 移动端适配
  - [ ] 平板端适配
- [ ] 添加搜索优化
  - [ ] 支持跨校区搜索
  - [ ] 搜索结果显示所属路径

### 7. 测试和验证
- [ ] 单元测试
  - [ ] API 接口测试
  - [ ] 数据验证测试
- [ ] 集成测试
  - [ ] 完整用户流程测试
  - [ ] 级联操作测试
- [ ] 性能测试
  - [ ] 大数据量查询优化
  - [ ] 缓存策略实施
- [ ] 用户体验测试
  - [ ] 导航流畅性
  - [ ] 错误处理

### 8. 文档更新
- [ ] 更新 README.md
  - [ ] 新的分类结构说明
  - [ ] 使用指南
- [ ] 创建 CATEGORIES.md
  - [ ] 分类系统架构文档
  - [ ] 数据模型说明
- [ ] 更新 API 文档
  - [ ] 新增接口说明
  - [ ] 参数变更说明

### 9. 部署准备
- [ ] 数据库迁移脚本准备
- [ ] 环境变量检查
- [ ] 备份策略制定
- [ ] 回滚方案准备
- [ ] 监控告警设置

## 📊 进度跟踪
- 总任务数：约 70 项
- 已完成：0 项
- 完成度：0%

## 📝 备注
- 优先级：数据库 → API → 前端组件 → 管理后台 → 测试
- 预计工期：3-5 天
- 关键风险：数据迁移时的兼容性问题

## 🔄 更新记录
- 2025-01-03：创建执行计划