# 认证系统说明

## 功能概述

这是一个简单的网页认证流程，当用户尝试访问服务时会弹出认证对话框，用户需要回答配置的问题才能继续使用服务。

## 主要特性

### 1. 认证对话框
- 弹出式对话框设计，与现有网站风格保持一致
- 支持文字和图片两种问题类型
- 优雅的加载状态和错误提示

### 2. 问题配置
- 问题和答案存储在 `config/auth-config.json` 中
- 支持多种问题类型：
  - `text`: 纯文字问题
  - `image`: 图片验证码问题
- 每个问题可配置多个可接受的答案

### 3. 模糊匹配算法
- 使用 Levenshtein 距离算法计算字符串相似度
- 默认 50% 以上相似度即判断为正确答案
- 支持完全匹配、模糊匹配和包含匹配三种方式
- 自动进行大小写标准化处理

### 4. 智能提示系统
- **自定义错误提示**: 每个问题可配置专属的错误提示信息
- **渐进式提示**: 答错次数越多，提示越详细
- **小贴士系统**: 第一次答错后显示配置的提示信息
- **个性化反馈**: 根据问题内容提供相关的错误提示

### 5. 用户体验
- 配置化的最大尝试次数
- 实时显示剩余尝试次数和个性化错误提示
- 认证状态实时显示在页面头部
- 认证成功后自动执行待处理的操作
- 优雅的提示信息展示，帮助用户理解问题

## 配置文件格式

```json
{
  "questions": [
    {
      "id": "text_question_1",
      "type": "text",
      "question": "番禺校区校霸是?",
      "answers": ["猫", "猫猫", "猫猫猫", "cat", "Cat"],
      "hints": [
        "提示：这是一种可爱的小动物 🐱",
        "提示：它们经常在校园里悠闲地散步",
        "提示：学生们都很喜欢它们，经常投喂小鱼干"
      ],
      "errorMessages": [
        "再想想，校园里最常见的小动物是什么？",
        "不对哦，番禺校区的学生都知道答案！",
        "最后一次机会了，想想那些在校园里自由自在的小家伙..."
      ]
    },
    {
      "id": "text_question_2",
      "type": "text", 
      "question": "暨南大学的校训是什么？",
      "answers": ["忠信笃敬", "忠信篤敬"],
      "hints": [
        "提示：四个字，关于品德修养",
        "提示：第一个字是'忠'，最后一个字是'敬'"
      ],
      "errorMessages": [
        "这是暨南大学的校训，每个暨大人都应该知道！",
        "再仔细想想，这四个字体现了做人的品德..."
      ]
    }
  ],
  "config": {
    "maxAttempts": 3,
    "showHints": true,
    "randomizeQuestions": true
  }
}
```

## 使用说明

1. **访问网站**: 打开 http://localhost:3002
2. **查看认证状态**: 右上角显示当前认证状态（已认证/未认证）
3. **触发认证**: 点击任何服务卡片的 "Try Now" 按钮
4. **完成认证**: 在弹出的对话框中回答问题
5. **访问服务**: 认证成功后自动跳转到目标服务

## 技术实现

### 主要组件
- `AuthDialog`: 认证对话框组件
- `fuzzy-match.ts`: 模糊匹配算法实现
- `auth-config.json`: 问题配置文件

### 依赖包
- `@radix-ui/react-dialog`: 对话框组件
- `@radix-ui/react-label`: 表单标签组件
- `lucide-react`: 图标库

### 核心功能
- 随机问题选择：每次认证都会随机选择一个问题
- 状态管理：使用 React State 管理认证状态和对话框显示
- 错误处理：优雅处理图片加载失败、网络错误等情况

## 自定义配置

### 添加新问题
编辑 `config/auth-config.json` 文件，添加新的问题对象：

```json
{
  "id": "new_question",
  "type": "text",
  "question": "您的问题?",
  "answers": ["答案1", "答案2", "答案3"],
  "hints": [
    "第一个提示信息",
    "第二个更详细的提示",
    "最后的明确提示"
  ],
  "errorMessages": [
    "第一次答错的提示",
    "第二次答错的提示", 
    "最后一次机会的提示"
  ]
}
```

### 配置参数说明
- **hints**: 可选，提示信息数组，第一次答错后显示
- **errorMessages**: 可选，自定义错误提示数组，按答错次数显示
- **config.maxAttempts**: 最大尝试次数（默认3次）
- **config.showHints**: 是否显示提示信息（默认true）
- **config.randomizeQuestions**: 是否随机选择问题（默认true）

### 调整匹配阈值
修改 `lib/fuzzy-match.ts` 中的默认 `threshold` 参数（默认 0.5 即 50%）。

### 修改尝试次数
在 `components/auth-dialog.tsx` 中修改 `maxAttempts` 常量（默认 3 次）。

## 安全说明

这是一个演示性质的简单认证系统，主要用于：
- 防止自动化爬虫
- 基础的用户验证
- 简单的访问控制

**注意**: 这不是一个安全的身份验证系统，不适用于保护敏感数据或重要业务逻辑。